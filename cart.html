<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AKHEEL ¬∑ cart</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = 'https://pwvyxhtlmozfeqorlnib.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_YsCixepPw0lGeBEq7R902g_TeA';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>
  <script src="cart.js"></script>
  
  <style>
    * { margin:0; padding:0; box-sizing:border-box; image-rendering:pixelated; }
    body {
      background:#faf8f5; font-family:'VT323',monospace; color:#1e1e1e; font-size:1.4rem;
      border:8px solid #1e1e1e; min-height:100vh; margin:1rem; padding:1.5rem;
    }
    h1,h2,h3 { font-family:'Press Start 2P',cursive; margin-bottom:1.5rem; text-transform:uppercase; }
    h1 { font-size:2.2rem; } h2 { font-size:1.6rem; margin-top:2rem; }
    nav {
      display:flex; flex-wrap:wrap; gap:1.2rem; margin-bottom:3rem;
      border-bottom:4px solid #1e1e1e; padding-bottom:1.5rem; align-items:center;
    }
    .nav-link {
      background:#fff; border:4px solid #1e1e1e; font-family:'Press Start 2P',cursive;
      font-size:0.8rem; padding:0.8rem 1.2rem; cursor:pointer; box-shadow:4px 4px 0 #1e1e1e;
      text-decoration:none; color:#1e1e1e; transition:all 0.05s linear;
    }
    .nav-link:hover, .nav-link.active { background:#1e1e1e; color:#fff; transform:translate(4px,4px); box-shadow:none; }
    .nav-link.active { pointer-events:none; }
    .container { max-width:1300px; margin:0 auto; }
    footer { margin-top:4rem; border-top:4px solid #1e1e1e; padding-top:1.5rem; text-align:center; }

    .cart-container {
      max-width:800px; margin:2rem auto; border:4px solid #1e1e1e; background:#fff;
      padding:2rem; box-shadow:8px 8px 0 #1e1e1e;
    }
    .cart-item {
      display:flex; align-items:center; justify-content:space-between;
      border-bottom:2px solid #1e1e1e; padding:1rem 0;
    }
    .cart-item-info { flex:2; }
    .cart-item-quantity { display:flex; align-items:center; gap:0.5rem; }
    .cart-item-quantity button {
      background:#1e1e1e; color:#fff; border:2px solid #1e1e1e; width:30px; height:30px;
      font-family:'Press Start 2P',cursive; cursor:pointer;
    }
    .cart-total { font-size:2rem; text-align:right; margin:2rem 0 1rem; border-top:4px solid #1e1e1e; padding-top:1rem; }
    .checkout-btn {
      width:100%; background:#1e1e1e; color:#fff; border:4px solid #1e1e1e;
      font-family:'Press Start 2P',cursive; font-size:1.2rem; padding:1rem; cursor:pointer;
      box-shadow:4px 4px 0 #1e1e1e; transition:all 0.05s linear;
    }
    .checkout-btn:hover { background:#fff; color:#1e1e1e; transform:translate(4px,4px); box-shadow:none; }
    #user-greeting { font-family:'Press Start 2P',cursive; font-size:0.7rem; color:#1e1e1e; margin-right:1rem; }
  </style>
</head>
<body>
  <div class="container">
    <header><h1># AKHEEL.</h1></header>
    <nav>
      <a href="index.html" class="nav-link">HOME</a>
      <a href="timeline.html" class="nav-link">TIMELINE</a>
      <a href="projects.html" class="nav-link">PROJECTS</a>
      <a href="products.html" class="nav-link">PRODUCTS</a>
      <a href="cart.html" class="nav-link active">CART</a>
      <a href="about.html" class="nav-link">ABOUT</a>
      <div style="margin-left:auto; display:flex; gap:1rem; align-items:center;">
        <span id="user-greeting"></span>
        <a href="login.html" class="nav-link" id="login-link">LOGIN</a>
        <a href="#" class="nav-link" id="logout-link" style="display:none;" onclick="logout()">LOGOUT</a>
      </div>
    </nav>
    <main>
      <div class="cart-container">
        <h2>YOUR CART</h2>
        <div id="cart-items"></div>
        <div class="cart-total">Total: ‚Çπ<span id="cart-total">0</span></div>
        <button class="checkout-btn" onclick="proceedToCheckout()">CHECKOUT</button>
      </div>
    </main>
    <footer><p>¬© 2025 AKHEEL. ‚Äì cart</p></footer>
  </div>

  <script>
    window.renderCart = function() {
      const container = document.getElementById('cart-items');
      if (!container) return;
      if (!cart || cart.length === 0) {
        container.innerHTML = '<p>Your cart is empty.</p>';
        document.getElementById('cart-total').innerText = '0';
        return;
      }
      let html = '';
      cart.forEach(item => {
        html += `
          <div class="cart-item">
            <div class="cart-item-info">
              <strong>${item.product_name}</strong><br>‚Çπ${(item.price/100).toFixed(2)} each
            </div>
            <div class="cart-item-quantity">
              <button onclick="changeQty('${item.product_id}', -1)">-</button>
              <span>${item.quantity}</span>
              <button onclick="changeQty('${item.product_id}', 1)">+</button>
              <button onclick="removeItem('${item.product_id}')" style="margin-left:1rem;">üóëÔ∏è</button>
            </div>
          </div>
        `;
      });
      container.innerHTML = html;
      document.getElementById('cart-total').innerText = (getCartTotal() / 100).toFixed(2);
    };

    window.changeQty = async function(productId, delta) {
      const item = cart.find(i => i.product_id === productId);
      if (item) await updateQuantity(productId, item.quantity + delta);
    };

    window.removeItem = async function(productId) {
      await removeFromCart(productId);
    };

    window.proceedToCheckout = function() {
      alert('Checkout will be implemented soon.');
    };

    supabase.auth.onAuthStateChange((event, session) => {
      const greeting = document.getElementById('user-greeting');
      const loginLink = document.getElementById('login-link');
      const logoutLink = document.getElementById('logout-link');
      if (session) {
        greeting.innerText = `Hi, ${session.user.email}`;
        loginLink.style.display = 'none';
        logoutLink.style.display = 'inline-block';
      } else {
        greeting.innerText = '';
        loginLink.style.display = 'inline-block';
        logoutLink.style.display = 'none';
      }
    });

    window.logout = async function() {
      await supabase.auth.signOut();
      location.reload();
    };
  </script>
</body>
</html>
